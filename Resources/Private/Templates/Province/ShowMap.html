<f:layout name="Default" />

This Template is responsible for displaying a single view for a domain object

If you modify this template, do not forget to change the overwrite settings
in /Configuration/ExtensionBuilder/settings.yaml:
  Resources:
    Private:
      Templates:
        Show.html: keep

Otherwise your changes will be overwritten the next time you save the extension in the extension builder

<!-- <fed:script src="http://maps.google.com/maps/api/js?sensor=true" />
<fed:script src="typo3conf/ext/buechertransport/Resources/Public/Javascript/maps.js" /> -->

<f:section name="main">

<link href="{f:uri.resource(path:'CSS/maps.css')}" rel="stylesheet" />

<script type="text/javascript" src="http://www.google.com/jsapi"></script> 
<script type="text/javascript" src="{f:uri.resource(path:'Javascript/maps.js')}"></script>

<!-- Initialize --> 
<script type="text/javascript"> 
// Globals
var map = null;
var infoWindow = null;
var geoXml = null;
var geoXmlDoc = null;
var myLatLng = null;
var myOptions = null;
var mapCenter = null;
var geocodeTheCountry = true;
var gpolygons = [];

// Fusion Table data ID
var FT_TableID = 420419;
var CountryName = "Germany";
var ProvinceName = "{province.name}";

google.load('visualization', '1', {'packages':['corechart', 'table', 'geomap']});
</script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript">
// these set the initial center, zoom and maptype for the map 
// if it is not specified in the query string
var lat = 51.5383520;
var lng = 9.92968990;
myLatLng = new google.maps.LatLng(lat, lng);

var maptype = google.maps.MapTypeId.ROADMAP;
var zoom = 17;

function initialize() {
	// Set map configuration
	myOptions = {
		'zoom': zoom,
		'center': myLatLng,
		'mapTypeId': maptype
	};
	map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

	// Render Province centered map
	var provinceCoord = '';
	var geocoder = new google.maps.Geocoder();
	if (geocoder && geocodeTheCountry) {
		// geocoder.geocode( { 'address': CountryName + " Country" }, function(results, status) {
		geocoder.geocode( { 'address': ProvinceName + " State" }, function(results, status) {
			if (status == google.maps.GeocoderStatus.OK) {
				if (status != google.maps.GeocoderStatus.ZERO_RESULTS) {
					map.setCenter(results[0].geometry.location);
					map.fitBounds(results[0].geometry.viewport);
					provinceCoord = results[0].geometry.location;
				} else {
					alert("No results found");
				}
			} else {
				alert("Geocode was not successful for the following reason: " + status);
			}
		});
    }

	// Render FusionTableLayer for Highlighting
	// Simple map presentation
	// var FT_Query = "SELECT 'kml_4326' FROM " + FT_TableID + " WHERE 'name_0' = '" + CountryName + "' AND 'name_1' = '" + ProvinceName + "';";
	// var FT_Options = { suppressInfoWindows: true, query: FT_Query};
	// layer = new google.maps.FusionTablesLayer(FT_TableID, FT_Options);
	// layer.setMap(map);

	// Map presentation with highlighted polygons
	layer = new google.maps.FusionTablesLayer({
	  suppressInfoWindows: true, 
	  query: {
	    'select': 'kml_4326',
	    'from': FT_TableID //'19lLpgsKdJRHL2O4fNmJ406ri9JtpIIk8a-AchA'
	  },
	  styles: [{
	    polygonOptions: {
	      'fillColor': "#FFFFFF",
	      'fillOpacity': .01,
	      'strokeColor': "#666666",
	      'strokeOpacity': .01,
	      'strokeWeight': 0
	    }
	  }, {
	    where: "'name_1' = '" + ProvinceName + "'",
	    polygonOptions: {
	      'fillColor': "#93A8CF", 
	      'fillOpacity': 0.1,
	      'strokeColor': "#1A3771",
	      'strokeOpacity': 0.5,
	      'strokeWeight': 5,
	    }
	  }]
	});
	layer.setMap(map);

	// Necessary arrays
	city = []; latlng = []; line = []; lineCoordinates = []; marker = [];
	var lineSymbol = {
		// 'path': google.maps.SymbolPath.FORWARD_CLOSED_ARROW
		'path': 'M 0,0 L 5,-5 L -12.5,0 L 5,5 L 0,0 z',
		'fillColor': '#333',
		'fillOpacity': 0.8,
		'scale': 1,
 		'rotation': 90,
	};
	var polyOptions = {
		strokeColor: '#333333',
		strokeOpacity: 1.0,
		strokeWeight: 2
	}
<f:for each="{province.reachables}" as="city" iteration="Iterator">
	// Set marker
	city[{Iterator.index}] = "{city.name}";
	// geocoder.geocode( { 'address': city[{Iterator.index}] + " City" }, function(results, status) {
	// 	if (status == google.maps.GeocoderStatus.OK) {
	// 		if (status != google.maps.GeocoderStatus.ZERO_RESULTS) {
	latlng[{Iterator.index}] = "{city.geocode}";
	marker[{Iterator.index}] = new google.maps.Marker({'position': latlng[{Iterator.index}], 'map': map, 'title': city[{Iterator.index}]});

	// Draw line
	lineCoordinates[{Iterator.index}] = [
  		provinceCoord,
  		latlng[{Iterator.index}]
	];
	line[{Iterator.index}] = new google.maps.Polyline({
		'path': lineCoordinates[{Iterator.index}],
		'icons': [{
			'icon': lineSymbol,
			'offset': '100%'
		}],
		'map': map
	});
	line[{Iterator.index}].setOptions(polyOptions);
	// 		}
	// 	}
	// });
</f:for>

	// // Set up and create the infowindow
	// if (!infoWindow) infoWindow = new google.maps.InfoWindow({});
	// infoWindow.setOptions({
	// 	content: infoWindowContent(name, description),
	// 	pixelOffset: new google.maps.Size(0, 2),
	// 	position: position
	// });
	// // Infowindow-opening event handler
	// infoWindow.open(map);
}
</script>

<h2>Kartenansicht: <f:translate key="tx_buechertransport_domain_model_province.maps" /> von {province.name}</h2>

<f:flashMessages />

<!-- <div id="map-province_{province.uid}" class="map-container"></div>
<f:format.html><a class="map" id="cl-province_{province.uid}" title="{f:translate(key:'maptitle')}">Karte</a></f:format.html>
 -->

<table style="width:100%;">
	<tr><td>
    	<div id="map_canvas"></div>
	</td></tr>
</table>




<f:link.action action="list"><f:translate key="tx_buechertransport_template_backToList" /></f:link.action><br />

</f:section>